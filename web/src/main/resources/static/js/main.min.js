/**
 *
 * Created by OAKutsenko on 10.03.2018.
 */
function getFormData(e){var t={};return $.each($(e).find("input, select").serializeArray(),function(e,a){t.hasOwnProperty(a.name)?(t[a.name]=$.makeArray(t[a.name]),t[a.name].push(a.value)):t[a.name]=a.value}),JSON.stringify(t)}function showNotification(e,t,a){$.notify({icon:"error_outline",message:a},{type:"danger",timer:1e4,placement:{from:e,align:t}})}function linkHandler(){$("#LinkForm").validate({rules:{sum:{min:100,max:1e5},text:{required:!0,maxlength:29}},errorPlacement:function(e,t){$(t).parent("div").addClass("has-error")},submitHandler:function(e){console.log(getFormData(e)),$.ajax({url:"/data/url",type:"POST",data:getFormData(e),beforeSend:function(e){e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json");var t=$("meta[name='_csrf']").attr("content"),a=$("meta[name='_csrf_header']").attr("content");null!=t&&null!=a&&e.setRequestHeader(a,t)},success:function(e,t,a){$("#item").html("URL"),$("#btn_create").addClass("hidden"),$("#btn_copy").removeClass("hidden"),$("div.info-content").html("").append('<textarea readonly style="width: 100%; height: 100%; border: none; resize: none; " id="url"></textarea>'),$("#url").html(e.url),$("input, div.bootstrap-select").each(function(){$(this).attr("disabled",!0).unbind("click")}),$("button.btn-trans").attr("disabled",!0)}})}}),$(".selectpicker").selectpicker("refresh").on("changed.bs.select",function(e){$("#btn_create").attr("disabled",!($(".selectpicker").val().length>1))}),$(".selectpicker option").length<2&&showNotification("top","left",error_not_reg),$("div.info-content").html(info.main),$("input, div.bootstrap-select").each(function(){$(this).click(function(){var e="";e=$(this).data("item")?$(this).data("item"):$(this).siblings("label").text(),$("#item").html(e),$("div.info-content").html("<p>"+info[e]+"</p>")})}),$("#btn_copy").click(function(){$("#url").select(),document.execCommand("Copy"),document.getSelection().removeAllRanges()})}$(document).ready(function(){var e=navigator.language||navigator.userLanguage||navigator.systemLanguage||"ru";$("ul.nav li").click(function(n){var r=$(this);null!=$(this).attr("id")&&$.ajax({url:"/"+$(this).attr("id"),success:function(e,t,a){null==a.getResponseHeader("Location")?window.location=document.location.origin+"/login":($("div.row").html(e),$("li.active").removeClass("active"),r.addClass("active"))},complete:function(n,r){!function(n){switch(n.replace("/","")){case"operations":$("#datatables").DataTable({ajax:{url:"/data/operations",dataSrc:function(e){return null!=e.data.length&&$("#datatables").find("tfoot").show(),e.data}},language:{url:"/locale/dt/"+e+".json"},aoColumnDefs:[{sType:"date-ru",aTargets:[7]}],columns:[{data:"type",render:function(e,t,a){return operations[e]}},{data:"m_src",orderable:!1,render:function(e,t,n){return a(e)}},{data:"m_dst",orderable:!1,render:function(e,t,n){return a(e)}},{data:"amount",orderable:!1,render:function(e,a,n){return t.format(e)}},{data:"fee",orderable:!1,render:function(e,a,n){return t.format(e)}},{data:"bank",orderable:!1},{data:"t_id",orderable:!1},{data:"time"}],order:[[7,"desc"]]});break;case"profile":$("#uname").val($("#user").html());break;case"settings":linkHandler()}}(n.getResponseHeader("Location"))}})});var t=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",minimumFractionDigits:2});function a(e){return-1!=e.search(/\D/i)?4==e.length?e.replace("*","*** **** **** **"):e.replace("*"," **** **** "):e.match(/^79/i)?e.replace(/^\d{2}(\d{2})(\d{3})(\d{2})(\d{2})$/,"+7 (9$1) $2-$3-$4"):e.match(/^380/i)?e.replace(/^\d{3}(\d{2})(\d{3})(\d{2})(\d{2})$/,"+380 $1 $2-$3-$4"):e.match(/^375/i)?e.replace(/^\d{3}(\d{2})(\d{3})(\d{2})(\d{2})$/,"+375 $1 $2-$3-$4"):e.match(/^77/i)?e.replace(/^\d{2}(\d{2})(\d{3})(\d{2})(\d{2})$/,"+7 7$1 $2-$3-$4"):e.match(/^3706/i)?e.replace(/^\d{3}(\d{3})(\d{5})$/,"+370 $1 $2"):e}$("#user").html(a($("#user").html())).show()}),$.ajaxSetup({beforeSend:function(e,t){var a=$("meta[name='_csrf']").attr("content"),n=$("meta[name='_csrf_header']").attr("content");null!=a&&null!=n&&e.setRequestHeader(n,a)}}),jQuery.extend(jQuery.fn.dataTableExt.oSort,{"date-ru-pre":function(e){return e.replace(/^(\d{2})\/(\d{2})\/(\d{4})/,"$3$2$1")},"date-ru-asc":function(e,t){return e<t?-1:e>t?1:0},"date-ru-desc":function(e,t){return e<t?1:e>t?-1:0}});